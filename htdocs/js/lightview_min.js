var Lightview={Version:"2.2.9.2",options:{backgroundColor:"#ffffff",border:12,buttons:{opacity:{disabled:0.4,normal:0.75,hover:1},side:{display:true},innerPreviousNext:{display:true},slideshow:{display:true}},cyclic:false,images:(window.parent.document.location.host.match(/yigg\.de$/)?window.parent.document.location.protocol+"//static.yigg.de/v6/":"")+"images/lightview/",imgNumberTemplate:"Image #{position} of #{total}",keyboard:{enabled:true},overlay:{background:"#000",close:true,opacity:0.85,display:true},preloadHover:true,radius:12,removeTitles:true,resizeDuration:0.9,slideshowDelay:5,titleSplit:"::",transition:function(a){return((a/=0.5)<1?0.5*Math.pow(a,4):-0.5*((a-=2)*Math.pow(a,3)-2))},viewport:true,zIndex:5000,closeDimensions:{large:{width:85,height:22},small:{width:32,height:22},innertop:{width:22,height:22},topclose:{width:22,height:18}},defaultOptions:{ajax:{width:400,height:300},iframe:{width:400,height:300,scrolling:true},inline:{width:400,height:300},flash:{width:400,height:300},quicktime:{width:480,height:220,autoplay:true,controls:true,topclose:true}},sideDimensions:{width:16,height:22}},classids:{quicktime:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",flash:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},codebases:{quicktime:"http://www.apple.com/qtactivex/qtplugin.cab#version=7,3,0,0",flash:"http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,115,0"},errors:{requiresPlugin:"<div class='message'>The content your are attempting to view requires the <span class='type'>#{type}</span> plugin.</div><div class='pluginspage'><p>Please download and install the required plugin from:</p><a href='#{pluginspage}' target='_blank'>#{pluginspage}</a></div>"},mimetypes:{quicktime:"video/quicktime",flash:"application/x-shockwave-flash"},pluginspages:{quicktime:"http://www.apple.com/quicktime/download",flash:"http://www.adobe.com/go/getflashplayer"},typeExtensions:{flash:"swf",image:"bmp gif jpeg jpg png",iframe:"asp aspx cgi cfm htm html jsp php pl php3 php4 php5 phtml rb rhtml shtml txt",quicktime:"avi mov mpg mpeg movie"}};Lightview.IEVersion=(function(b){var a=new RegExp("MSIE ([\\d.]+)").exec(b);return a?parseFloat(a[1]):-1})(navigator.userAgent);Object.extend(Prototype.Browser,{IE6:Prototype.Browser.IE&&(Lightview.IEVersion>=6&&Lightview.IEVersion<7),WebKit419:(Prototype.Browser.WebKit&&!document.evaluate)});Object.extend(Lightview,{REQUIRED_Prototype:"1.6.0.2",REQUIRED_Scriptaculous:"1.8.1",queue:{position:"end",scope:"lightview"},isMac:!!navigator.userAgent.match(/mac/i),pngOverlay:!!navigator.userAgent.match(/mac/i)&&(Prototype.Browser.WebKit||Prototype.Browser.Gecko),require:function(a){if((typeof window[a]=="undefined")||(this.convertVersionString(window[a].Version)<this.convertVersionString(this["REQUIRED_"+a]))){throw ("Lightview requires "+a+" >= "+this["REQUIRED_"+a])}},convertVersionString:function(a){var b=a.replace(/_.*|\./g,"");b=parseInt(b+"0".times(4-b.length));return a.indexOf("_")>-1?b-1:b},load:function(){this.require("Prototype");if(!!window.Effect&&!window.Scriptaculous){this.require("Scriptaculous")}if(this.options.images.include("://")){this.images=this.options.images}else{var a=/lightview(?:-[\w\d.]+)?\.js(.*)/;this.images=(($$("head script[src]").find(function(b){return b.src.match(a)})||{}).src||"").replace(a,"")+this.options.images}if(Prototype.Browser.IE&&!document.namespaces.v){document.namespaces.add("v","urn:schemas-microsoft-com:vml");document.observe("dom:loaded",function(){document.createStyleSheet().addRule("v\\:*","behavior: url(#default#VML);")})}},start:function(){this.radius=this.options.radius;this.border=(this.radius>this.options.border)?this.radius:this.options.border;this.closeDimensions=this.options.closeDimensions;this.sideDimensions=this.options.sideDimensions;this.build();this.updateViews();this.addObservers()},build:function(){var b,e,a=this.pixelClone(this.sideDimensions);$(document.body).insert(this.overlay=new Element("div",{id:"overlay"}).setStyle({zIndex:this.options.zIndex-1,position:(!(Prototype.Browser.Gecko||Prototype.Browser.IE6))?"fixed":"absolute",background:this.pngOverlay?"url("+this.images+"overlay.png) top left repeat":this.options.overlay.background}).setOpacity((Prototype.Browser.Gecko)?1:this.options.overlay.opacity).hide()).insert(this.lightview=new Element("div",{id:"lightview"}).setStyle({zIndex:this.options.zIndex,top:"-10000px",left:"-10000px"}).setOpacity(0).insert(this.container=new Element("div",{className:"lv_Container"}).insert(this.sideButtons=new Element("ul",{className:"lv_Sides"}).insert(this.prevSide=new Element("li",{className:"lv_PrevSide"}).setStyle(e=Object.extend({marginLeft:-1*this.sideDimensions.width+"px"},a)).insert(this.prevButtonImage=new Element("div",{className:"lv_Wrapper"}).setStyle(Object.extend({marginLeft:this.sideDimensions.width+"px"},a)).insert(new Element("div",{className:"lv_Button"})))).insert(this.nextSide=new Element("li",{className:"lv_NextSide"}).setStyle(Object.extend({marginRight:-1*this.sideDimensions.width+"px"},a)).insert(this.nextButtonImage=new Element("div",{className:"lv_Wrapper"}).setStyle(e).insert(new Element("div",{className:"lv_Button"}))))).insert(this.topButtons=new Element("div",{className:"lv_topButtons"}).insert(this.topcloseButtonImage=new Element("div",{className:"lv_Wrapper lv_topcloseButtonImage"}).insert(this.topcloseButton=new Element("div",{className:"lv_Button"})))).insert(new Element("ul",{className:"lv_Frames"}).insert(new Element("li",{className:"lv_Frame lv_FrameTop"}).insert(b=new Element("div",{className:"lv_Liquid"}).setStyle({height:this.border+"px"}).insert(new Element("ul",{className:"lv_Half lv_HalfLeft"}).insert(new Element("li",{className:"lv_CornerWrapper"}).insert(new Element("div",{className:"lv_Corner"})).insert(new Element("div",{className:"lv_Fill"}).setStyle({left:this.border+"px"})))).insert(new Element("div",{className:"lv_Filler"})).insert(new Element("ul",{className:"lv_Half lv_HalfRight"}).insert(new Element("li",{className:"lv_CornerWrapper"}).setStyle("margin-top: "+(-1*this.border)+"px").insert(new Element("div",{className:"lv_Corner"})).insert(new Element("div",{className:"lv_Fill"}).setStyle("left: "+(-1*this.border)+"px")))))).insert(this.resizeCenter=new Element("li",{className:"lv_Center"}).setStyle("height: "+(150-this.border)+"px").insert(new Element("div",{className:"lv_WrapUp"}).insert(new Element("div",{className:"lv_WrapDown"}).setStyle("margin-top: "+this.border+"px").insert(this.center=new Element("div",{className:"lv_WrapCenter"}).setOpacity(0).setStyle("padding: 0 "+this.border+"px").insert(this.media=new Element("div",{className:"lv_Media lv_Fill"})).insert(this.menubar=new Element("div",{className:"lv_MenuBar"}).insert(this.closeButton=new Element("div",{className:"lv_Button lv_Close"}).setStyle(this.pixelClone(this.options.closeDimensions.large)).setStyle({background:this.options.backgroundColor}).setOpacity(this.options.buttons.opacity.normal)).insert(this.data=new Element("ul",{className:"lv_Data"}).insert(this.dataText=new Element("li",{className:"lv_DataText"}).insert(this.title=new Element("div",{className:"lv_Title"})).insert(this.caption=new Element("div",{className:"lv_Caption"}))).insert(this.imgNumber=new Element("li",{className:"lv_ImgNumber"}).insert(new Element("div"))).insert(this.innerPrevNext=new Element("li",{className:"lv_innerPrevNext"}).insert(this.innerPrevButton=new Element("div",{className:"lv_Button"}).setOpacity(this.options.buttons.opacity.normal).setStyle({backgroundColor:this.options.backgroundColor}).setPngBackground(this.images+"inner_prev.png",{backgroundColor:this.options.backgroundColor})).insert(this.innerNextButton=new Element("div",{className:"lv_Button"}).setOpacity(this.options.buttons.opacity.normal).setStyle({backgroundColor:this.options.backgroundColor}).setPngBackground(this.images+"inner_next.png",{backgroundColor:this.options.backgroundColor}))).insert(this.slideshow=new Element("li",{className:"lv_Slideshow"}).insert(this.slideshowButton=new Element("div",{className:"lv_Button"}).setOpacity(this.options.buttons.opacity.normal).setStyle({backgroundColor:this.options.backgroundColor}).setPngBackground(this.images+"inner_slideshow_play.png",{backgroundColor:this.options.backgroundColor}))))).insert(this.external=new Element("div",{className:"lv_External"}))))).insert(this.loading=new Element("div",{className:"lv_Loading"}).insert(this.loadingButton=new Element("div",{className:"lv_Button"}).setStyle("background: url("+this.images+"loading.gif) top left no-repeat")))).insert(new Element("li",{className:"lv_Frame lv_FrameBottom"}).insert(b.cloneNode(true))).insert(this.prevnext=new Element("li",{className:"lv_PrevNext"}).hide().setStyle("margin-top: "+this.border+"px; background: url("+this.images+"blank.gif) top left repeat"))))).insert(new Element("div",{id:"lightviewError"}).hide());var f=new Image();f.onload=function(){f.onload=Prototype.emptyFunction;this.sideDimensions={width:f.width,height:f.height};var j=this.pixelClone(this.sideDimensions),k;this.sideButtons.setStyle({marginTop:0-(f.height/2).round()+"px",height:f.height+"px"});this.prevSide.setStyle(k=Object.extend({marginLeft:-1*this.sideDimensions.width+"px"},j));this.prevButtonImage.setStyle(Object.extend({marginLeft:j.width},j));this.nextSide.setStyle(Object.extend({marginRight:-1*this.sideDimensions.width+"px"},j));this.nextButtonImage.setStyle(k)}.bind(this);f.src=this.images+"prev.png";$w("center title caption imgNumber").each(function(j){this[j].setStyle({backgroundColor:this.options.backgroundColor})}.bind(this));var g=this.container.select(".lv_Corner");$w("tl tr bl br").each(function(j,k){if(this.radius>0){this.createCorner(g[k],j)}else{g[k].insert(new Element("div",{className:"lv_Fill"}))}g[k].setStyle({width:this.border+"px",height:this.border+"px"}).addClassName("lv_Corner"+j.capitalize())}.bind(this));this.lightview.select(".lv_Filler",".lv_Fill",".lv_WrapDown").invoke("setStyle",{backgroundColor:this.options.backgroundColor});var i={};$w("prev next topclose").each(function(j){this[j+"ButtonImage"].side=j;var k=this.images+j+".png";if(j=="topclose"){i[j]=new Image();i[j].onload=function(){i[j].onload=Prototype.emptyFunction;this.closeDimensions[j]={width:i[j].width,height:i[j].height};var l=this.isMac?"left":"right",m=Object.extend({"float":l,marginTop:this.closeDimensions[j].height+"px"},this.pixelClone(this.closeDimensions[j]));m["padding"+l.capitalize()]=this.border+"px";this[j+"ButtonImage"].setStyle(m);this.topButtons.setStyle({height:i[j].height+"px",top:-1*this.closeDimensions[j].height+"px"});this[j+"ButtonImage"].down().setPngBackground(k).setStyle(this.pixelClone(this.closeDimensions[j]))}.bind(this);i[j].src=this.images+j+".png"}else{this[j+"ButtonImage"].setPngBackground(k)}}.bind(this));var c={};$w("large small innertop").each(function(j){c[j]=new Image();c[j].onload=function(){c[j].onload=Prototype.emptyFunction;this.closeDimensions[j]={width:c[j].width,height:c[j].height}}.bind(this);c[j].src=this.images+"close_"+j+".png"}.bind(this));var d=new Image();d.onload=function(){d.onload=Prototype.emptyFunction;this.loading.setStyle({width:d.width+"px",height:d.height+"px",marginTop:-0.5*d.height+0.5*this.border+"px",marginLeft:-0.5*d.width+"px"})}.bind(this);d.src=this.images+"loading.gif";var h=new Image();h.onload=function(){h.onload=Prototype.emptyFunction;var j={width:h.width+"px",height:h.height+"px"};this.slideshow.setStyle(j);this.slideshowButton.setStyle(j)}.bind(this);h.src=this.images+"inner_slideshow_play.png";$w("prev next").each(function(j){var k=j.capitalize(),l=new Image();l.onload=function(){l.onload=Prototype.emptyFunction;this["inner"+k+"Button"].setStyle({width:l.width+"px",height:l.height+"px"})}.bind(this);l.src=this.images+"inner_"+j+".png";this["inner"+k+"Button"].prevnext=j}.bind(this))},prepare:function(){Effect.Queues.get("lightview").each(function(a){a.cancel()});this.scaledInnerDimensions=null;this.restoreInlineContent();this.views=null},restoreInlineContent:function(){if(!this.inlineContent||!this.inlineMarker){return}this.inlineMarker.insert({after:this.inlineContent.setStyle({display:this.inlineContent._inlineDisplayRestore})});this.inlineMarker.remove();this.inlineMarker=null},show:function(d){this.element=null;if(Object.isElement(d)||Object.isString(d)){this.element=$(d);if(!this.element){return}this.element.blur();this.view=this.element._view}else{if(d.href){this.element=$(document.body);this.view=new Lightview.View(d)}else{if(Object.isNumber(d)){this.element=this.getSet(this.view.rel).elements[d];this.view=this.element._view}}}if(!this.view.href){return}this.prepare();this.disableKeyboardNavigation();this.hideOverlapping();this.hideContent();this.restoreCenter();this.appear();if(this.view.href!="#lightviewError"&&Object.keys(Lightview.Plugin).join(" ").indexOf(this.view.type)>=0){if(!Lightview.Plugin[this.view.type]){$("lightviewError").update(new Template(this.errors.requiresPlugin).evaluate({type:this.view.type.capitalize(),pluginspage:this.pluginspages[this.view.type]}));var c=$("lightviewError").getDimensions();this.show({href:"#lightviewError",title:this.view.type.capitalize()+" plugin required",options:c});return false}}if(this.view.isGallery()){this.views=this.view.isGallery()?this.getViews(this.view.rel):[this.view]}var a=Object.extend({menubar:true,topclose:false,wmode:"transparent",innerPreviousNext:this.view.isGallery()&&this.options.buttons.innerPreviousNext.display,slideshow:this.view.isGallery()&&this.options.buttons.slideshow.display},this.options.defaultOptions[this.view.type]||{});this.view.options=Object.extend(a,this.view.options);if(!(this.view.title||this.view.caption||(this.views&&this.views.length>1))&&this.view.options.topclose){this.view.options.menubar=false}if(this.view.isImage()){if(this.view.isGallery()){this.position=this.views.indexOf(this.view);this.preloadSurroundingImages()}this.innerDimensions=this.view.preloadedDimensions;if(this.innerDimensions){this.afterEffect()}else{this.startLoading();var b=new Image();b.onload=function(){b.onload=Prototype.emptyFunction;this.stopLoading();this.innerDimensions={width:b.width,height:b.height};this.afterEffect()}.bind(this);b.src=this.view.href}}else{this.innerDimensions=this.view.options.fullscreen?document.viewport.getDimensions():{width:this.view.options.width,height:this.view.options.height};this.afterEffect()}},insertContent:function(){var a=this.detectExtension(this.view.href),d=this.scaledInnerDimensions||this.innerDimensions;if(this.view.isImage()){var c=this.pixelClone(d);this.media.setStyle(c).update(new Element("img",{id:"lightviewContent",src:this.view.href,alt:"",galleryimg:"no"}).setStyle(c))}else{if(this.view.isExternal()){if(this.scaledInnerDimensions&&this.view.options.fullscreen){d.height-=this.menuBarDimensions.height}switch(this.view.type){case"ajax":var k=Object.clone(this.view.options.ajax)||{};var l=function(){this.stopLoading();if(this.view.options.autosize){this.external.setStyle({width:"auto",height:"auto"});this.innerDimensions=this.getHiddenDimensions(this.external)}new Effect.Event({queue:this.queue,afterFinish:function(){this.resizeWithinViewport();NinjaCommander.initialize()}.bind(this)})}.bind(this);if(k.onComplete){k.onComplete=k.onComplete.wrap(function(m,n){l();m(n)})}else{k.onComplete=l}this.startLoading();new Ajax.Updater(this.external,this.view.href,k);break;case"iframe":this.external.update(this.iframe=new Element("iframe",{frameBorder:0,hspace:0,src:this.view.href,id:"lightviewContent",name:"lightviewContent_"+(Math.random()*99999).round(),scrolling:(this.view.options&&this.view.options.scrolling)?"auto":"no"}).setStyle(Object.extend({border:0,margin:0,padding:0},this.pixelClone(d))));break;case"inline":var b=this.view.href,i=$(b.substr(b.indexOf("#")+1));if(!i||!i.tagName){return}var e=new Element(this.view.options.wrapperTag||"div"),j=i.getStyle("visibility"),g=i.getStyle("display");i.wrap(e);i.setStyle({visibility:"hidden"}).show();var h=this.getHiddenDimensions(e);i.setStyle({visibility:j,display:g});e.insert({before:i}).remove();i.insert({before:this.inlineMarker=new Element(i.tagName)});i._inlineDisplayRestore=i.getStyle("display");this.inlineContent=i.show();this.external.update(this.inlineContent);this.external.select("select, object, embed").each(function(m){this.overlappingRestore.each(function(n){if(n.element==m){m.setStyle({visibility:n.visibility})}})}.bind(this));if(this.view.options.autosize){this.innerDimensions=h;new Effect.Event({queue:this.queue,afterFinish:this.resizeWithinViewport.bind(this)})}break}}else{var f={tag:"object",id:"lightviewContent",width:d.width,height:d.height};switch(this.view.type){case"quicktime":Object.extend(f,{pluginspage:this.pluginspages[this.view.type],children:[{tag:"param",name:"autoplay",value:this.view.options.autoplay},{tag:"param",name:"scale",value:"tofit"},{tag:"param",name:"controller",value:this.view.options.controls},{tag:"param",name:"enablejavascript",value:true},{tag:"param",name:"src",value:this.view.href},{tag:"param",name:"loop",value:this.view.options.loop||false}]});Object.extend(f,Prototype.Browser.IE?{codebase:this.codebases[this.view.type],classid:this.classids[this.view.type]}:{data:this.view.href,type:this.mimetypes[this.view.type]});break;case"flash":Object.extend(f,{data:this.view.href,type:this.mimetypes[this.view.type],quality:"high",wmode:this.view.options.wmode,pluginspage:this.pluginspages[this.view.type],children:[{tag:"param",name:"movie",value:this.view.href},{tag:"param",name:"allowFullScreen",value:"true"}]});if(this.view.options.flashvars){f.children.push({tag:"param",name:"FlashVars",value:this.view.options.flashvars})}break}this.media.setStyle(this.pixelClone(d)).show();this.media.update(this.createHTML(f));if(this.view.isQuicktime()&&$("lightviewContent")){(function(){try{if("SetControllerVisible" in $("lightviewContent")){$("lightviewContent").SetControllerVisible(this.view.options.controls)}}catch(m){}}.bind(this)).delay(0.4)}}}},getHiddenDimensions:function(e){e=$(e);var a=e.ancestors(),d=[],b=[];a.push(e);a.each(function(f){if(f!=e&&f.visible()){return}d.push(f);b.push({display:f.getStyle("display"),position:f.getStyle("position"),visibility:f.getStyle("visibility")});f.setStyle({display:"block",position:"absolute",visibility:"visible"})});var c={width:e.clientWidth,height:e.clientHeight};d.each(function(f,g){f.setStyle(b[g])});return c},clearContent:function(){var a=$("lightviewContent");if(a){switch(a.tagName.toLowerCase()){case"object":if(Prototype.Browser.WebKit&&this.view.isQuicktime()){try{a.Stop()}catch(b){}a.innerHTML=""}if(a.parentNode){a.remove()}else{a=Prototype.emptyFunction}break;case"iframe":a.remove();if(Prototype.Browser.Gecko){delete window.frames.lightviewContent}break;default:a.remove();break}}},adjustDimensionsToView:function(){var a=this.scaledInnerDimensions||this.innerDimensions;if(this.view.options.controls){switch(this.view.type){case"quicktime":a.height+=16;break}}this[(this.scaledInnerDimensions?"scaledI":"i")+"nnerDimensions"]=a},afterEffect:function(){new Effect.Event({queue:this.queue,afterFinish:function(){this.afterShow()}.bind(this)})},afterShow:function(){this.fillMenuBar();if(!this.view.isAjax()){this.stopLoading()}if(!((this.view.options.autosize&&this.view.isInline())||this.view.isAjax())){this.resizeWithinViewport()}if(!this.view.isIframe()){new Effect.Event({queue:this.queue,afterFinish:this.insertContent.bind(this)})}},finishShow:function(){new Effect.Event({queue:this.queue,afterFinish:this.showContent.bind(this)});if(this.view.isIframe()){new Effect.Event({delay:0.2,queue:this.queue,afterFinish:this.insertContent.bind(this)})}if(this.sliding){new Effect.Event({queue:this.queue,afterFinish:this.nextSlide.bind(this)})}},previous:function(){this.show(this.getSurroundingIndexes().previous)},next:function(){this.show(this.getSurroundingIndexes().next)},resizeWithinViewport:function(){this.adjustDimensionsToView();var f=this.getInnerDimensions(),d=this.getBounds();if(this.options.viewport&&(f.width>d.width||f.height>d.height)){if(!this.view.options.fullscreen){var c=Object.clone(this.getOuterDimensions()),a=d,e=Object.clone(c);if(e.width>a.width){e.height*=a.width/e.width;e.width=a.width;if(e.height>a.height){e.width*=a.height/e.height;e.height=a.height}}else{if(e.height>a.height){e.width*=a.height/e.height;e.height=a.height;if(e.width>a.width){e.height*=a.width/e.width;e.width=a.width}}}var b=(e.width%1>0?e.height/c.height:e.height%1>0?e.width/c.width:1);this.scaledInnerDimensions={width:(this.innerDimensions.width*b).round(),height:(this.innerDimensions.height*b).round()};this.fillMenuBar();f={width:this.scaledInnerDimensions.width,height:this.scaledInnerDimensions.height+this.menuBarDimensions.height}}else{this.scaledInnerDimensions=d;this.fillMenuBar();f=d}}else{this.fillMenuBar();this.scaledInnerDimensions=null}this.resize(f)},resize:function(c){var l=this.lightview.getDimensions(),i=2*this.border,a=c.width+i,e=c.height+i;this.hidePrevNext();var f=function(){this.restoreCenter();this.resizing=null;this.finishShow()};if(l.width==a&&l.height==e){f.bind(this)();return}var b={width:a+"px",height:e+"px"};if(!Prototype.Browser.IE6){Object.extend(b,{marginLeft:0-a/2+"px",marginTop:0-e/2+"px"})}var k=a-l.width,g=e-l.height,h=parseInt(this.lightview.getStyle("marginLeft").replace("px","")),m=parseInt(this.lightview.getStyle("marginTop").replace("px",""));if(!Prototype.Browser.IE6){var d=(0-a/2)-h,j=(0-e/2)-m}this.resizing=new Effect.Tween(this.lightview,0,1,{duration:this.options.resizeDuration,queue:this.queue,transition:this.options.transition,afterFinish:f.bind(this)},function(o){var r=(l.width+o*k).toFixed(0),p=(l.height+o*g).toFixed(0);if(Prototype.Browser.IE6){this.lightview.setStyle({width:(l.width+o*k).toFixed(0)+"px",height:(l.height+o*g).toFixed(0)+"px"});this.resizeCenter.setStyle({height:p-1*this.border+"px"})}else{if(Prototype.Browser.IE){this.lightview.setStyle({position:"fixed",width:r+"px",height:p+"px",marginLeft:((0-r)/2).round()+"px",marginTop:((0-p)/2).round()+"px"});this.resizeCenter.setStyle({height:p-1*this.border+"px"})}else{var q=this.getViewportDimensions(),n=document.viewport.getScrollOffsets();this.lightview.setStyle({position:"absolute",marginLeft:0,marginTop:0,width:r+"px",height:p+"px",left:(n[0]+(q.width/2)-(r/2)).floor()+"px",top:(n[1]+(q.height/2)-(p/2)).floor()+"px"});this.resizeCenter.setStyle({height:p-1*this.border+"px"})}}}.bind(this))},showContent:function(){new Effect.Event({queue:this.queue,afterFinish:Element.show.bind(this,this[this.view.isMedia()?"media":"external"])});new Effect.Event({queue:this.queue,afterFinish:this.hidePrevNext.bind(this)});new Effect.Parallel([new Effect.Opacity(this.center,{sync:true,from:0,to:1}),new Effect.Appear(this.sideButtons,{sync:true})],{queue:this.queue,duration:0.45,afterFinish:function(){if(this.element){this.element.fire("lightview:opened")}}.bind(this)});if(this.view.isGallery()){new Effect.Event({queue:this.queue,afterFinish:this.showPrevNext.bind(this)})}},hideContent:function(){if(!this.lightview.visible()){return}new Effect.Parallel([new Effect.Opacity(this.sideButtons,{sync:true,from:1,to:0}),new Effect.Opacity(this.center,{sync:true,from:1,to:0})],{queue:this.queue,duration:0.35});new Effect.Event({queue:this.queue,afterFinish:function(){this.clearContent();this.media.update("").hide();this.external.update("").hide();this.topcloseButtonImage.setStyle({marginTop:this.closeDimensions.topclose.height+"px"})}.bind(this)})},hideData:function(){this.dataText.hide();this.title.hide();this.caption.hide();this.imgNumber.hide();this.innerPrevNext.hide();this.slideshow.hide()},fillMenuBar:function(){this.hideData();if(!this.view.options.menubar){this.menuBarDimensions={width:0,height:0};this.closeButtonWidth=0;this.menubar.hide();return false}else{this.menubar.show()}this.menubar[(this.view.isExternal()?"add":"remove")+"ClassName"]("lv_MenuTop");if(this.view.title||this.view.caption){this.dataText.show()}if(this.view.title){this.title.update(this.view.title).show()}if(this.view.caption){this.caption.update(this.view.caption).show()}if(this.views&&this.views.length>1){this.imgNumber.show().down().update(new Template(this.options.imgNumberTemplate).evaluate({position:this.position+1,total:this.views.length}));if(this.view.options.slideshow){this.slideshowButton.show();this.slideshow.show()}}if(this.view.options.innerPreviousNext&&this.views.length>1){var a={prev:(this.options.cyclic||this.position!=0),next:(this.options.cyclic||(this.view.isGallery()&&this.getSurroundingIndexes().next!=0))};$w("prev next").each(function(b){this["inner"+b.capitalize()+"Button"].setStyle({cursor:(a[b]?"pointer":"auto")}).setOpacity(a[b]?this.options.buttons.opacity.normal:this.options.buttons.opacity.disabled)}.bind(this));this.innerPrevNext.show()}this.setCloseButtons();this.setMenuBarDimensions()},setCloseButtons:function(){var d=this.closeDimensions.small.width,e=this.closeDimensions.large.width,b=this.closeDimensions.innertop.width,a=this.scaledInnerDimensions?this.scaledInnerDimensions.width:this.innerDimensions.width,c=180,f=0,g=this.options.borderColor;if(this.view.options.topclose){g=null}else{if(!this.view.isMedia()){g="innertop";f=b}else{if(a>=c+d&&a<c+e){g="small";f=d}else{if(a>=c+e){g="large";f=e}}}}if(f>0){this.closeButton.setStyle({width:f+"px"}).show()}else{this.closeButton.hide()}if(g){this.closeButton.setPngBackground(this.images+"close_"+g+".png",{backgroundColor:this.options.backgroundColor})}this.closeButtonWidth=f},startLoading:function(){this.loadingEffect=new Effect.Appear(this.loading,{duration:0.3,from:0,to:1,queue:this.queue})},stopLoading:function(){if(this.loadingEffect){Effect.Queues.get("lightview").remove(this.loadingEffect)}new Effect.Fade(this.loading,{duration:1,queue:this.queue})},setPrevNext:function(){if(!this.view.isImage()){return}var b=(this.options.cyclic||this.position!=0),d=(this.options.cyclic||(this.view.isGallery()&&this.getSurroundingIndexes().next!=0));this.prevButtonImage[b?"show":"hide"]();this.nextButtonImage[d?"show":"hide"]();var c=this.scaledInnerDimensions||this.innerDimensions;this.prevnext.setStyle({height:c.height+"px"});var a=((c.width/2-1)+this.border).floor();if(b){this.prevnext.insert(this.prevButton=new Element("div",{className:"lv_Button lv_PrevButton"}).setStyle({width:a+"px"}));this.prevButton.side="prev"}if(d){this.prevnext.insert(this.nextButton=new Element("div",{className:"lv_Button lv_NextButton"}).setStyle({width:a+"px"}));this.nextButton.side="next"}if(b||d){this.prevnext.show()}},showPrevNext:function(){if(!this.options.buttons.side.display||!this.view.isImage()){return}this.setPrevNext();this.prevnext.show()},hidePrevNext:function(){this.prevnext.update("").hide();this.prevButtonImage.hide().setStyle({marginLeft:this.sideDimensions.width+"px"});this.nextButtonImage.hide().setStyle({marginLeft:-1*this.sideDimensions.width+"px"})},appear:function(){if(this.lightview.getStyle("opacity")!=0){return}var a=function(){if(!Prototype.Browser.WebKit419){this.lightview.show()}this.lightview.setOpacity(1)}.bind(this);if(this.options.overlay.display){new Effect.Appear(this.overlay,{duration:0.4,from:0,to:this.pngOverlay?1:this.options.overlay.opacity,queue:this.queue,beforeStart:this.maxOverlay.bind(this),afterFinish:a})}else{a()}},hide:function(){if(Prototype.Browser.IE&&this.iframe&&this.view.isIframe()){this.iframe.remove()}if(Prototype.Browser.WebKit419&&this.view.isQuicktime()){var a=$$("object#lightviewContent")[0];if(a){try{a.Stop()}catch(b){}}}if(this.lightview.getStyle("opacity")==0){return}this.stopSlideshow();this.prevnext.hide();if(!Prototype.Browser.IE||!this.view.isIframe()){this.center.hide()}if(Effect.Queues.get("lightview_hide").effects.length>0){return}Effect.Queues.get("lightview").each(function(c){c.cancel()});new Effect.Event({queue:this.queue,afterFinish:this.restoreInlineContent.bind(this)});new Effect.Opacity(this.lightview,{duration:0.1,from:1,to:0,queue:{position:"end",scope:"lightview_hide"}});new Effect.Fade(this.overlay,{duration:0.4,queue:{position:"end",scope:"lightview_hide"},afterFinish:this.afterHide.bind(this)})},afterHide:function(){if(!Prototype.Browser.WebKit419){this.lightview.hide()}else{this.lightview.setStyle({marginLeft:"-10000px",marginTop:"-10000px"})}this.center.setOpacity(0).show();this.prevnext.update("").hide();this.clearContent();this.media.update("").hide();this.external.update("").hide();this.disableKeyboardNavigation();this.showOverlapping();if(this.element){this.element.fire("lightview:hidden")}this.element=null;this.views=null;this.view=null;this.scaledInnerDimensions=null},setMenuBarDimensions:function(){var b={},a=this[(this.scaledInnerDimensions?"scaledI":"i")+"nnerDimensions"].width;this.menubar.setStyle({width:a+"px"});this.data.setStyle({width:a-this.closeButtonWidth-1+"px"});b=this.getHiddenDimensions(this.menubar);this.menubar.setStyle({width:"100%"});this.menuBarDimensions=this.view.options.menubar?b:{width:b.width,height:0}},restoreCenter:function(){var c=this.lightview.getDimensions();if(Prototype.Browser.IE6){this.lightview.setStyle({top:"50%",left:"50%"})}else{if(Prototype.Browser.WebKit419||Prototype.Browser.Gecko){var a=this.getViewportDimensions(),b=document.viewport.getScrollOffsets();this.lightview.setStyle({marginLeft:0,marginTop:0,left:(b[0]+(a.width/2)-(c.width/2)).floor()+"px",top:(b[1]+(a.height/2)-(c.height/2)).floor()+"px"})}else{this.lightview.setStyle({position:"fixed",left:"50%",top:"50%",marginLeft:(0-c.width/2).round()+"px",marginTop:(0-c.height/2).round()+"px"})}}},startSlideshow:function(){this.stopSlideshow();this.sliding=true;this.next.bind(this).delay(0.25);this.slideshowButton.setPngBackground(this.images+"inner_slideshow_stop.png",{backgroundColor:this.options.backgroundColor}).hide()},stopSlideshow:function(){if(this.sliding){this.sliding=false}if(this.slideTimer){clearTimeout(this.slideTimer)}this.slideshowButton.setPngBackground(this.images+"inner_slideshow_play.png",{backgroundColor:this.options.backgroundColor})},toggleSlideshow:function(){this[(this.sliding?"stop":"start")+"Slideshow"]()},nextSlide:function(){if(this.sliding){this.slideTimer=this.next.bind(this).delay(this.options.slideshowDelay)}},updateViews:function(){this.sets=[];var a=$$("a[class~=lightview]");a.each(function(c){c.stopObserving();new Lightview.View(c);c.observe("click",this.show.curry(c).wrap(function(d,e){e.stop();d(e)}).bindAsEventListener(this));if(c._view.isImage()){if(this.options.preloadHover){c.observe("mouseover",this.preloadImageHover.bind(this,c._view))}var b=a.partition(function(d){return d.rel==c.rel});if(b[0].length){this.sets.push({rel:c._view.rel,elements:b[0]});a=b[1]}}}.bind(this))},getSet:function(a){return this.sets.find(function(b){return b.rel==a})},getViews:function(a){return this.getSet(a).elements.pluck("_view")},addObservers:function(){$(document.body).observe("click",this.delegateClose.bindAsEventListener(this));$w("mouseover mouseout").each(function(c){this.prevnext.observe(c,function(e){var d=e.findElement("div");if(!d){return}if(this.prevButton&&this.prevButton==d||this.nextButton&&this.nextButton==d){this.toggleSideButton(e)}}.bindAsEventListener(this))}.bind(this));this.prevnext.observe("click",function(d){var c=d.findElement("div");if(!c){return}var e=(this.prevButton&&this.prevButton==c)?"previous":(this.nextButton&&this.nextButton==c)?"next":null;if(e){this[e].wrap(function(f,g){this.stopSlideshow();f(g)}).bind(this)()}}.bindAsEventListener(this));$w("prev next").each(function(c){var d=c.capitalize(),f=function(g,h){this.stopSlideshow();g(h)},e=function(g,h){var i=h.element().prevnext;if((i=="prev"&&(this.options.cyclic||this.position!=0))||(i=="next"&&(this.options.cyclic||(this.view.isGallery()&&this.getSurroundingIndexes().next!=0)))){g(h)}};this[c+"ButtonImage"].observe("mouseover",this.toggleSideButton.bindAsEventListener(this)).observe("mouseout",this.toggleSideButton.bindAsEventListener(this)).observe("click",this[c=="next"?c:"previous"].wrap(f).bindAsEventListener(this));this["inner"+d+"Button"].observe("click",this[c=="next"?c:"previous"].wrap(e).bindAsEventListener(this)).observe("mouseover",Element.setOpacity.curry(this["inner"+d+"Button"],this.options.buttons.opacity.hover).wrap(e).bindAsEventListener(this)).observe("mouseout",Element.setOpacity.curry(this["inner"+d+"Button"],this.options.buttons.opacity.normal).wrap(e).bindAsEventListener(this))}.bind(this));var b=[this.closeButton,this.slideshowButton];if(!Prototype.Browser.WebKit419){b.each(function(c){c.observe("mouseover",Element.setOpacity.bind(this,c,this.options.buttons.opacity.hover)).observe("mouseout",Element.setOpacity.bind(this,c,this.options.buttons.opacity.normal))}.bind(this))}else{b.invoke("setOpacity",1)}this.slideshowButton.observe("click",this.toggleSlideshow.bindAsEventListener(this));if(Prototype.Browser.WebKit419||Prototype.Browser.Gecko){var a=function(c,d){if(this.lightview.getStyle("top").charAt(0)=="-"){return}c(d)};Event.observe(window,"scroll",this.restoreCenter.wrap(a).bindAsEventListener(this));Event.observe(window,"resize",this.restoreCenter.wrap(a).bindAsEventListener(this))}if(Prototype.Browser.Gecko){Event.observe(window,"resize",this.maxOverlay.bindAsEventListener(this))}this.lightview.observe("mouseover",this.toggleTopClose.bindAsEventListener(this)).observe("mouseout",this.toggleTopClose.bindAsEventListener(this));this.topcloseButton.observe("mouseover",this.toggleTopClose.bindAsEventListener(this)).observe("mouseout",this.toggleTopClose.bindAsEventListener(this))},toggleTopClose:function(b){var c=b.type;if(!this.view){c="mouseout"}else{if(!(this.view&&this.view.options&&this.view.options.topclose&&(this.center.getOpacity()==1))){return}}if(this.topCloseEffect){Effect.Queues.get("lightview_topCloseEffect").remove(this.topCloseEffect)}var a={marginTop:((c=="mouseover")?0:this.closeDimensions.topclose.height)+"px"};this.topCloseEffect=new Effect.Morph(this.topcloseButtonImage,{style:a,duration:0.2,queue:{scope:"lightview_topCloseEffect",limit:1},delay:(c=="mouseout"?0.3:0)})},getScrollDimensions:function(){var a={};$w("width height").each(function(b){var c=b.capitalize();var d=document.documentElement;a[b]=Prototype.Browser.IE?[d["offset"+c],d["scroll"+c]].max():Prototype.Browser.WebKit?document.body["scroll"+c]:d["scroll"+c]});return a},maxOverlay:function(){if(!Prototype.Browser.Gecko){return}this.overlay.setStyle(this.pixelClone(document.viewport.getDimensions()));this.overlay.setStyle(this.pixelClone(this.getScrollDimensions()))},delegateClose:function(a){if(!this.delegateCloseElements){this.delegateCloseElements=[this.closeButton,this.topButtons,this.loadingButton,this.topcloseButton];if(this.options.overlay.close){this.delegateCloseElements.push(this.overlay)}}if(a.target&&(this.delegateCloseElements.include(a.target))){this.hide()}},toggleSideButton:function(c){var e=c.target,f=e.side,a=this.sideDimensions.width,b=(c.type=="mouseover")?0:f=="prev"?a:-1*a,d={marginLeft:b+"px"};if(!this.sideEffect){this.sideEffect={}}if(this.sideEffect[f]){Effect.Queues.get("lightview_side"+f).remove(this.sideEffect[f])}this.sideEffect[f]=new Effect.Morph(this[f+"ButtonImage"],{style:d,duration:0.2,queue:{scope:"lightview_side"+f,limit:1},delay:(c.type=="mouseout"?0.1:0)})},getSurroundingIndexes:function(){if(!this.views){return}var b=this.position,c=this.views.length;var d=(b<=0)?c-1:b-1,a=(b>=c-1)?0:b+1;return{previous:d,next:a}},createCorner:function(c,b){var d=arguments[2]||this.options,h=d.radius,e=d.border,f=new Element("canvas",{className:"cornerCanvas"+b.capitalize(),width:e+"px",height:e+"px"}),a={top:(b.charAt(0)=="t"),left:(b.charAt(1)=="l")};if(f&&f.getContext&&f.getContext("2d")){c.insert(f);var g=f.getContext("2d");g.fillStyle=d.backgroundColor;g.arc((a.left?h:e-h),(a.top?h:e-h),h,0,Math.PI*2,true);g.fill();g.fillRect((a.left?h:0),0,e-h,e);g.fillRect(0,(a.top?h:0),e,e-h)}else{c.insert(new Element("div").setStyle({width:e+"px",height:e+"px",margin:0,padding:0,display:"block",position:"relative",overflow:"hidden"}).insert(new Element("v:roundrect",{fillcolor:d.backgroundColor,strokeWeight:"1px",strokeColor:d.backgroundColor,arcSize:(h/e*0.5).toFixed(2)}).setStyle({width:2*e-1+"px",height:2*e-1+"px",position:"absolute",left:(a.left?0:(-1*e))+"px",top:(a.top?0:(-1*e))+"px"})))}},hideOverlapping:function(){if(this.preventingOverlap){return}var a=$$("select","embed","object");this.overlappingRestore=a.map(function(b){return{element:b,visibility:b.getStyle("visibility")}});a.invoke("setStyle","visibility:hidden");this.preventingOverlap=true},showOverlapping:function(){this.overlappingRestore.each(function(b,a){b.element.setStyle("visibility: "+b.visibility)});delete this.overlappingRestore;this.preventingOverlap=false},pixelClone:function(a){var b={};Object.keys(a).each(function(c){b[c]=a[c]+"px"});return b},getInnerDimensions:function(){return{width:this.innerDimensions.width,height:this.innerDimensions.height+this.menuBarDimensions.height}},getOuterDimensions:function(){var b=this.getInnerDimensions(),a=2*this.border;return{width:b.width+a,height:b.height+a}},getBounds:function(){var b=20,a=2*this.sideDimensions.height+b,c=this.getViewportDimensions();return{width:c.width-a,height:c.height-a}},getViewportDimensions:function(){var a=document.viewport.getDimensions();if(this.controller&&this.controller.visible()){a.height-=this.controllerOffset}return a}});Object.extend(Lightview,{enableKeyboardNavigation:function(){if(!this.options.keyboard.enabled){return}this.keyboardEvent=this.keyboardDown.bindAsEventListener(this);document.observe("keydown",this.keyboardEvent)},disableKeyboardNavigation:function(){if(!this.options.keyboard.enabled){return}if(this.keyboardEvent){document.stopObserving("keydown",this.keyboardEvent)}},keyboardDown:function(e){var f=String.fromCharCode(e.keyCode).toLowerCase(),c=e.keyCode,b=this.view.isGallery()&&!this.resizing,a=this.view.options.slideshow,d;if(this.view.isMedia()){e.stop();d=(c==Event.KEY_ESC||["x","c"].member(f))?"hide":(c==37&&b&&(this.options.cyclic||this.position!=0))?"previous":(c==39&&b&&(this.options.cyclic||this.getSurroundingIndexes().next!=0))?"next":(f=="p"&&a&&this.view.isGallery())?"startSlideshow":(f=="s"&&a&&this.view.isGallery())?"stopSlideshow":null;if(f!="s"){this.stopSlideshow()}}else{d=(c==Event.KEY_ESC)?"hide":null}if(d){this[d]()}if(b){if(c==Event.KEY_HOME&&this.views.first()!=this.view){this.show(this.views.first())}if(c==Event.KEY_END&&this.views.last()!=this.view){this.show(this.views.last())}}}});Lightview.afterShow=Lightview.afterShow.wrap(function(b,a){this.enableKeyboardNavigation();b(a)});Object.extend(Lightview,{preloadSurroundingImages:function(){if(this.views.length==0){return}var a=this.getSurroundingIndexes();this.preloadFromSet([a.next,a.previous])},preloadFromSet:function(b){var a=(this.views&&this.views.member(b)||Object.isArray(b))?this.views:b.rel?this.getViews(b.rel):null;if(!a){return}var c=$A(Object.isNumber(b)?[b]:b.type?[a.indexOf(b)]:b).uniq();c.each(function(e){var g=a[e],f=g.href;if(g.preloadedDimensions||g.isPreloading||!f){return}var d=new Image();d.onload=function(){d.onload=Prototype.emptyFunction;g.isPreloading=null;this.setPreloadedDimensions(g,d)}.bind(this);d.src=f}.bind(this))},setPreloadedDimensions:function(a,b){a.preloadedDimensions={width:b.width,height:b.height}},preloadImageHover:function(a){if(a.preloadedDimensions||a.isPreloading){return}this.preloadFromSet(a)}});Element.addMethods({setPngBackground:function(b,c){b=$(b);var a=Object.extend({align:"top left",repeat:"no-repeat",sizingMethod:"scale",backgroundColor:""},arguments[2]||{});b.setStyle(Prototype.Browser.IE6?{filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+c+"'', sizingMethod='"+a.sizingMethod+"')"}:{background:a.backgroundColor+" url("+c+") "+a.align+" "+a.repeat});return b}});Object.extend(Lightview,{detectType:function(a){var b;$w("flash image iframe quicktime").each(function(c){if(new RegExp("\\.("+this.typeExtensions[c].replace(/\s+/g,"|")+")(\\?.*)?","i").test(a)){b=c}}.bind(this));if(b){return b}if(a.startsWith("#")){return"inline"}if(document.domain&&document.domain!=(a).replace(/(^.*\/\/)|(:.*)|(\/.*)/g,"")){return"iframe"}return"image"},detectExtension:function(a){var b=a.gsub(/\?.*/,"").match(/\.([^.]{3,4})$/);return b?b[1]:null},createHTML:function(c){var b="<"+c.tag;for(var a in c){if(!["children","html","tag"].member(a)){b+=" "+a+'="'+c[a]+'"'}}if(new RegExp("^(?:area|base|basefont|br|col|frame|hr|img|input|link|isindex|meta|param|range|spacer|wbr)$","i").test(c.tag)){b+="/>"}else{b+=">";if(c.children){c.children.each(function(d){b+=this.createHTML(d)}.bind(this))}if(c.html){b+=c.html}b+="</"+c.tag+">"}return b}});(function(){document.observe("dom:loaded",function(){var b=(navigator.plugins&&navigator.plugins.length),a=function(d){var e=false;if(b){e=($A(navigator.plugins).pluck("name").join(",").indexOf(d)>=0)}else{try{e=new ActiveXObject(d)}catch(c){}}return !!e};window.Lightview.Plugin=(b)?{flash:a("Shockwave Flash"),quicktime:a("QuickTime")}:{flash:a("ShockwaveFlash.ShockwaveFlash"),quicktime:a("QuickTime.QuickTime")}})})();Lightview.View=Class.create({initialize:function(b){var c=Object.isElement(b);if(c&&!b._view){b._view=this;if(b.title){b._view._title=b.title;if(Lightview.options.removeTitles){b.title=""}}}this.href=c?b.getAttribute("href"):b.href;if(this.href.indexOf("#")>=0){this.href=this.href.substr(this.href.indexOf("#"))}if(b.rel&&b.rel.startsWith("gallery")){this.type="gallery";this.rel=b.rel}else{if(b.rel){this.type=b.rel;this.rel=b.rel}else{this.type=Lightview.detectType(this.href);this.rel=this.type}}$w("ajax flash gallery iframe image inline quicktime external media").each(function(a){var T=a.capitalize(),t=a.toLowerCase();if("image gallery media external".indexOf(a)<0){this["is"+T]=function(){return this.type==t}.bind(this)}}.bind(this));if(c&&b._view._title){var d=b._view._title.split(Lightview.options.titleSplit).invoke("strip");if(d[0]){this.title=d[0]}if(d[1]){this.caption=d[1]}var e=d[2];this.options=(e&&Object.isString(e))?eval("({"+e+"})"):{}}else{this.title=b.title;this.caption=b.caption;this.options=b.options||{}}if(this.options.ajaxOptions){this.options.ajax=Object.clone(this.options.ajaxOptions);delete this.options.ajaxOptions}},isGallery:function(){return this.type.startsWith("gallery")},isImage:function(){return(this.isGallery()||this.type=="image")},isExternal:function(){return"iframe inline ajax".indexOf(this.type)>=0},isMedia:function(){return !this.isExternal()}});Lightview.load();document.observe("dom:loaded",Lightview.start.bind(Lightview));