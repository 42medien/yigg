NinjaCommander=Class.create({initialize:function(){this.startForms(),this.startEditors(),this.startUpdaters(),this.startActions()},startEditors:function(){var a=$$(".tinymce");return a.size()>0?"object"!=typeof tinyMCE?(window.findAndLoadMce=function(){tinyMCE.settings={theme:"advanced",theme_advanced_buttons1:"bold,underline,strikethrough,blockquote,|,link,unlink",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",valid_elements:"a[href],strong/b,strong,ol,ul,li,blockquote,p,br",paste_auto_cleanup_on_paste:!0,paste_remove_spans:!0,paste_remove_styles:!0,verify_html:!0,debug:!0,plugins:"paste",setup:function(a){!1===$(a.editorId).hasClassName("large")&&a.onKeyUp.add(function(a){var b=tinyMCE.activeEditor.getContent().replace(/(<([^>]+)>)/gi,"").length,c=b+" Zeichen",d=$("wordCount_"+a.id);if(!d){var e=$(tinyMCE.activeEditor.id+"_parent").down(".mceToolbar");d=$(new Element("span",{id:"wordCount_"+a.id,style:"font-size:12px;float:right; padding:5px 15px;"})),e.insert({top:d})}d.update(c),d.setStyle(b>=550?" color:red;":"color:green;")}),a.onInit.add(function(a){tinyMCE.editors[a.id].load()})}},$$(".tinymce").each(function(a){a.identify(),void 0===tinyMCE.get(a.id)&&(tinyMCE.execCommand("mceAddControl",!0,a.id),a.hasClassName("large")&&tinyMCE.get(a.id).remove("KeyUp")),-1!==$A(tinyMCE.editors).indexOf(a.id)&&tinyMCE.editors[a.id].load()})},$$("head")[0].insert(new Element("script",{src:"js/tiny_mce/tiny_mce.js?ver=1"})),void 0):(window.findAndLoadMce(),void 0):(document.observe("lightview:loaded",function(){NinjaCommander.initalize()}),void 0)},startActions:function(){$$("a.ninjaAction").each(function(a){if(a.id){if(a.id||a.identify(),a.ninjaAction)return;a.ninjaAction=NinjaAction,a.observe("click",function(a){this.ninjaAction.executeAction(a),Event.stop(a)}.bind(a))}})},startForms:function(){$$("form.ninjaForm").each(function(a){a.id&&"object"!=typeof a.ninjaValidator&&(a.ninjaValidator=NinjaValidator,a.ninjaValidator.formName=a.id,token=$(a.id+"__csrf_token"),token&&(a.ninjaValidator.csrfToken=$F(token)),a.requiredElements=$$("#"+a.id+" .ninjaRequired"),a.requiredElements&&a.requiredElements.invoke("observe","blur",function(a){this.ninjaValidator.requiredCheck(a)}.bind(a)),a.validationElements=$$("#"+a.id+" .ninjaValidate"),a.validationElements&&a.validationElements.invoke("observe","blur",function(a){this.ninjaValidator.validateField(a)}.bind(a)),a.observe("submit",function(a){"object"==typeof tinyMCE&&tinyMCE.triggerSave(),this.ninjaValidator.preSubmitCheck(a)}.bind(a))),a.enable()})},startUpdaters:function(){$$(".ninjaUpdater").each(function(a){a.ninjaUpdater||(a.ninjaUpdater=new NinjaUpdater(a))})}}),NinjaComs=Class.create({debug:0,request:function(a,b,c,d,e,f){var g=b;if(!f)if(g=window.location.toString(),g.indexOf("?")>0){var h=g.substring(g.indexOf("?"),g.length);g=g.substring(0,g.indexOf("?")),g="/"==g.substring(g.length-1,g.length)?g+b:g+"/"+b+h}else g="/"==g.substring(g.length-1,g.length)?g+b:g+"/"+b;new Ajax.Request(g,{parameters:c,onComplete:e,onSuccess:this.handleResponse.bind(this),onFailure:this.handleResponse.bind(this),evalJS:!1,sanitizeJSON:!0,requestHeaders:{"Content-Token":a}})},updater:function(a,b,c,d,e,f){e||(e="post");new Ajax.Updater(c,b,{parameters:d,onComplete:f,method:e,sanitizeJSON:!0,requestHeaders:{"Content-Token":a}})},handleResponse:function(transport,json){if(304!=transport.status)if(200==transport.status)try{json&&json.each(function(el){var className=el.className,action=el.action;if(!1===Object.isUndefined(className)){var call=eval(className+"."+action);!0===Object.isFunction(call)&&call(el)}})}catch(exception){}else this.throwComsError("Server Response Error: "+transport.statusText+" Server Response incorrect",!0)},throwComsError:function(a,b){if(1==this.debug||b===!0){var c=new Element("h3",{"class":"error_message",style:"position:absolute; top:0px; margin:auto;"});c.update(a),$("Layout").appendChild(c),Effect.Shake(c)}}}),NinjaValidator={requiredText:" wird benötigt.",img_dir:(window.parent.document.location.host.match(/yigg\.de$/)?window.parent.document.location.protocol+"//yigg.de/":"")+"images/",validating_img:"ajaxindicator.gif",errors:0,target:null,requiredCheck:function(a){"blur"==a.type&&(a=Event.element(a));var b=a.parentNode;return this.resetFieldHolder(b),$F(a)?(this.addValidatedSpan(a,b),!0):(this.addMessageSpan(a,b),!1)},validateField:function(a){"blur"==a.type&&(a=Event.element(a));var b=a.parentNode;this.resetFieldHolder(b);var c=$F(a),d=a.hasClassName("optional");if(c&&!this.isSubmitting){this.addValidatingMsg(b);var e={};e[a.id]=c,this.ninjaComs||(this.ninjaComs=new NinjaComs),this.ninjaComs.request(this.csrfToken,"check"+a.id.capitalize(),e)}else{if(!(d||c&&this.isSubmitting))return this.addMessageSpan(a,b),!1;a.removeClassName("validated"),a.removeClassName("error")}},preSubmitCheck:function(a){this.isSubmitting=!0,this.errors=0;var b=Event.element(a);if(!1===this.doFormValidationCheck(b))return Event.stop(a),void 0;if(!0===b.hasClassName("ninjaAjaxSubmit")){var c=$(b).serialize(!0);b.disable(),this.ninjaComs||(this.ninjaComs=new NinjaComs),$w($(b).className).each(function(a){!a.startsWith("ninja")&&$(a)&&(this.target=$(a))}.bind(this));{new Ajax.Updater(this.target?this.target:$(b),$(b).action,{parameters:c,onComplete:function(){NinjaCommander.initialize()},onFailure:function(a){var c=a.responseText;$(b).replace(c),NinjaCommander.initialize()}.bind(b),method:"post",sanitizeJSON:!0,requestHeaders:{"Content-Token":this.csrfToken}})}Event.stop(a)}else this.isSubmitting=!1},doFormValidationCheck:function(a){return a.requiredElements.each(function(a){var b=this.requiredCheck(a);b||a.hasClassName("error")&&(this.errors++,Effect.Shake(a))}.bind(this)),0===this.errors?!0:!1},addValidatedSpan:function(a,b){a.removeClassName("error"),a.addClassName("validated"),this.resetFieldHolder(b);var c=new Element("span",{"class":"validated_message"});b.removeClassName("field_error"),b.addClassName("field_validated"),b.appendChild(c)},addValidatingMsg:function(a){this.resetFieldHolder(a);var b=new Element("img",{src:this.img_dir+this.validating_img,alt:"Überprüfung läuft.","class":"validating"});a.appendChild(b)},addMessageSpan:function(a,b,c){c||(c=NinjaValidator.unCamelize(a.id).capitalize()+this.requiredText),a.removeClassName("validated"),a.addClassName("error"),this.resetFieldHolder(b);var d=new Element("span",{"class":"error_message",id:"error_for_"+a.id});d.update(c),b.removeClassName("field_validated"),b.addClassName("field_error"),b.appendChild(d)},resetFieldHolder:function(a){$(a).getElementsBySelector(".error_message",".validated_message",".validating").invoke("remove")},updateForm:function(a){var b=$(a.elementId);!0===Object.isElement(b)?"error"==a.type?NinjaValidator.addMessageSpan(b,b.parentNode,a.error):NinjaValidator.addValidatedSpan(b,b.parentNode):a&&NinjaValidator.throwError("An Error was returned: "+a.error+", but there was no element found")},unCamelize:function(a){return a.replace(/[a-zA-Z][A-Z0-9]|[0-9][a-zA-Z]/g,function(a){return a.charAt(0)+" "+a.charAt(1)})}},NinjaUpdater=Class.create({type:"",action:"",callback:"",element:"",target:"",in_process:!1,current_event:"",script_dir:(window.parent.document.location.host.match(/www\.yigg\.de$/)?window.parent.document.location.protocol+"//yigg.de/":"")+"js/",script_suffix:".js",script_prefix:"ninjaCallback",script_replace:"ninjaCallback",initialize:function(a){a.identify(),this.element=a,this.initializeTarget(),this.initializeAction(),this.coms=new NinjaComs},initializeTarget:function(){$w(this.element.className).each(function(a){if(a.startsWith("ninjaCallback")){var b=new Element("script",{id:"script_"+a,type:"text/javascript",src:this.script_dir+a.replace("ninjaCallback",this.script_prefix)+this.script_suffix});a=a.replace(this.script_replace,""),document.observe(a+":loaded",function(a){this.callback=a.memo.updater}.bind(this)),Element.insert($A(document.getElementsByTagName("script")).last(),{after:b})}a.startsWith("ninja")||$(a)&&(this.target=$(a))}.bind(this)),this.target||(this.target=this.element)},initializeAction:function(){return this.element.hasAttribute("href")?(this.type="LINK",this.action=this.element.href,this.element.href="javascript:void(0);",this.initializeObserver("click","GET"),void 0):(this.element.hasAttribute("action")&&(this.element.hasClassName("ninjaFilter")?(this.type="FILTER",observer="change"):(this.type="FORM",observer="submit"),this.action=this.element.action,this.initializeObserver(observer,"POST")),void 0)},initializeObserver:function(a,b){Event.observe(this.element,a,function(a){if(this.current_event=a,Event.stop(a),!this.element.hasClassName("ninjaConfirm")||!1!==confirm("Sicher?")){var c="POST"==b?this.element.serialize(!0):"";return this.executeEvent(b,c)}}.bind(this))},executeEvent:function(a,b){return!0!==this.in_process?this.callback&&Object.isFunction(this.callback.executeUpdate)?(this.callback.executeUpdate(this),void 0):(!1!==this.preUpdate()&&(this.target.hide(),this.coms.updater(this.element.id,this.action,this.target,b,a,function(){this.target.show(),this.postUpdate(),this.target.appear({duration:3})}.bind(this))),void 0):void 0},preUpdate:function(){return this.element.ninjaValidator&&!1===this.element.ninjaValidator.doFormValidationCheck(this.element)?!1:this.callback&&Object.isFunction(this.callback.preUpdate)&&!1===this.callback.preUpdate(this)?!1:(this.in_process=!0,this.element.hasClassName("ninjaPreloader")&&this.target.update("loading"),"FILTER"==this.type&&this.element.disable(),void 0)},postUpdate:function(){this.callback&&Object.isFunction(this.callback.postUpdate)&&this.callback.postUpdate(this),this.in_process=!1,"FILTER"==this.type&&this.element.enable(),NinjaCommander.initialize()}}),NinjaAction={executeAction:function(a){el=Event.element(a);var b=NinjaValidator.unCamelize(el.id);b=b.replace(" ","/"),this.ninjaComs||(this.ninjaComs=new NinjaComs),this.ninjaComs.request(b,b,{elementId:el.id})},redirect:function(){console.log("redirecting to "+el.href),console.log("this really should get javascript back to know what to do ;)")},updateField:function(a){var b=$(a.elementId);!0===Object.isElement(b)?(b.enable(),b.value=a.value):a&&NinjaValidator.throwError("An Error was returned: "+a.error+", but there was no element found")},disableField:function(a){var b=$(a.elementId);!0===Object.isElement(b)?b.disable():a&&NinjaValidator.throwError("An Error was returned: "+a.error+", but there was no element found")},replaceContent:function(a){var b=$(a.elementId);!0===Object.isElement(b)?b.update(a.content):a&&NinjaValidator.throwError("An Error was returned: "+a.error+", but there was no element found")},removeElement:function(a){var b=$(a.elementId);!0===Object.isElement(b)?Element.remove(b):a&&NinjaValidator.throwError("An Error was returned: "+a.error+", but there was no element found")}},Event.observe(window,"load",function(){NinjaCommander=new NinjaCommander}),$$('a[rel="external"]').each(function(a){""!=a.readAttribute("href")&&"#"!=a.readAttribute("href")&&a.writeAttribute("target","_blank")});